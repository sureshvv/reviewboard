{% extends "base.html" %}
{% load reviewtags %}

{% block title %}Diff Viewer{% endblock %}
{% block extrahead %}
<script type="text/javascript" src="/scripts/prototype.js"></script>
<script type="text/javascript" src="/scripts/scriptaculous.js?load=builder"></script>
<script language="javascript" src="/scripts/diffviewer.js"></script>
{% endblock %}

{% block content %}
<div id="review-request">
 <div class="main">
  <table class="header">
   <colgroup>
    <col width="100%" />
    <col />
   </colgroup>
   <tr>
    <td id="summary_wrapper"><h1 id="summary"><a href="{{diffset.history.reviewrequest_set.get.get_absolute_url}}">{{diffset.history.reviewrequest_set.get.summary}}</a></h1></td>
    <td id="diff_revision" nowrap="nowrap">Diff revision {{diffset.revision}}</td>
   </tr>
   <tr>
    <td id="status">{{diffset.history.reviewrequest_set.get.get_status_display}}</td>
    <td id="created_time" nowrap="nowrap">Uploaded {{diffset.timestamp|timesince}} ago</td>
   </tr>
  </table>
  <a name="index_header"></a>
{% include "diffviewer/changeindex.html" %}
 </div>
 <ul class="controls">
{% if collapseall %}
  <li><a href="."><img src="/images/expand.png" width="14" height="14" border="0" alt="" /> Expand changes</a></li>
{% else %}
  <li><a href="{{request.path}}?collapse=1"><img src="/images/collapse.png" width="14" height="14" border="0" alt="" /> Collapse changes</a></li>
{% endif %}
 </ul>
</div>

<div id="diffs">
{% if error %}
 {{ error }}
 {% if trace %}<pre>{{ trace }}</pre>{% endif %}
{% else %}

{% for file in files %}
<a name="{{file.index}}"></a>
{% include "diffviewer/diff_file_fragment.html" %}
<script language="javascript">
  addComments("file{{file.index}}", {% commentinfo file.filediff %});
</script>
{% endfor %}
<a name="index_footer"></a>
{% include "diffviewer/changeindex.html" %}
{% endif %}
</div>
{% endblock %}
