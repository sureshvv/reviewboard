{% extends "base.html" %}
{% load reviewtags %}

{% block title %}Diff Viewer{% endblock %}
{% block extrahead %}
<script type="text/javascript" src="/scripts/yui/utilities/utilities.js"></script>
<script type="text/javascript" src="/scripts/yui-ext/yui-ext.js"></script>
<script language="javascript" src="/scripts/rb/core.js"></script>
<script language="javascript" src="/scripts/rb/widgets.js"></script>
<script language="javascript" src="/scripts/diffviewer.js"></script>
<link rel="stylesheet" type="text/css" href="/css/yui-ui.css" />
<script language="javascript">
  var gReviewRequestPath = '{{diffset.history.reviewrequest_set.get.get_absolute_url}}';
  var gRevision = '{{diffset.revision}}';
</script>
{% endblock %}

{% block content %}
<div id="review-request">
 <div class="main">
  <table class="header">
   <colgroup>
    <col width="100%" />
    <col />
   </colgroup>
   <tr>
    <td id="summary_wrapper"><h1 id="summary"><a href="{{diffset.history.reviewrequest_set.get.get_absolute_url}}">{{diffset.history.reviewrequest_set.get.summary}}</a></h1></td>
    <td id="diff_revision" nowrap="nowrap">Diff revision {{diffset.revision}}</td>
   </tr>
   <tr>
    <td id="status">{{diffset.history.reviewrequest_set.get.get_status_display}}</td>
    <td id="created_time" nowrap="nowrap">Uploaded {{diffset.timestamp|timesince}} ago</td>
   </tr>
  </table>
  <a name="index_header"></a>
{% include "diffviewer/changeindex.html" %}
 </div>
 <ul class="controls">
{% if collapseall %}
  <li><a href=".?expand=1"><img src="/images/expand.png" width="14" height="14" border="0" alt="" /> Expand changes</a></li>
{% else %}
  <li><a href=".?collapse=1"><img src="/images/collapse.png" width="14" height="14" border="0" alt="" /> Collapse changes</a></li>
{% endif %}
 </ul>
</div>

<div id="diffs">
{% if error %}
 {{ error }}
 {% if trace %}<pre>{{ trace }}</pre>{% endif %}
{% else %}

{% for file in files %}
<a name="{{file.index}}"></a>
{% include "diffviewer/diff_file_fragment.html" %}
<script language="javascript">
  gFileAnchorToId["file{{file.index}}"] = {{file.filediff.id}};
  addComments("file{{file.index}}", {% commentcounts file.filediff %});
</script>
{% endfor %}
<a name="index_footer"></a>
{% include "diffviewer/changeindex.html" %}
{% endif %}
</div>

<div id="comment-dlg" style="visibility:hidden;position:absolute;top:0px;">
 <div class="ydlg-hd">Comments</div>
 <div class="ydlg-bd">
  <div id="tab-comments" class="ydlg-tab" title="Comments">
   <div id="existing-comments"></div>
   <form id="commentform" class="comment draft" method="post" action="comments/">
	<input type="hidden" name="action" id="id_comment_action" value="" />
	<input type="hidden" name="num_lines" id="id_num_lines" value="" />
    <label for="id_comment">Your comment:</label><br />
	<textarea id="id_comment" name="text" rows="4" cols="20"></textarea>
   </form>
 </div>
 <div id="tab-review" class="ydlg-tab" title="Review">
  <form id="reviewform" method="post" action="{{diffset.history.reviewrequest_set.get.get_absolute_url}}/reply">
   <input type="hidden" name="diffset" value="{{diffset.id}}" />
   <input id="id_shipit" type="checkbox" name="shipit" value="shipit" {% if review and review.shipit %}checked="checked" {% endif %}/>Ship It!<br />
   <label for="id_body_top">Review Body:</label>
   <div id="review-body">
    <textarea id="id_body_top" name="body_top" rows="5" cols="20">{% if review %}{{review.body_top|escape}}{% endif %}</textarea>
    <div id="all-review-comments"><i>Comments will be displayed here</i></div>
    <textarea id="id_body_bottom" name="body_bottom" rows="5" cols="20">{% if review %}{{review.body_bottom|escape}}{% endif %}</textarea>
   </div>
  </form>
 </div>
</div>
{% endblock %}
